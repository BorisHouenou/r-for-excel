# Synthesis {#synthesis}

TODO:
- stringr
- Argaux, (?) or NOAA landings 
- Closing (15 mins)


## Summary

In this session, we'll pull together the skills that we've learned so far. We'll create a new GitHub repo and R project, wrangle and visualize data from spreadsheets in R Markdown, communicate between RStudio (locally) and GitHub (remotely) to keep our updates safe, then share our outputs in a nicely formatted GitHub ReadMe. And we'll learn a few new things along the way! 

![Grolemund & Wickham R4DS Illustration](img/r4ds_data-science.png)

## Objectives

- Create a new repo on GitHub
- Clone the repo to create a new version-controlled R project 
- Create a new R Markdown document 
- Attach necessary packages (`tidyverse`, `here`, `janitor`, `kableExtra`)
- Use `here::here()` for simpler (and safer) file paths
- Basic data wrangling (`dplyr`, `tidyr`, etc.)
- HTL tables with `kable()` and `kableExtra`
- Data visualization (`ggplot2`)
- Publish with a useful ReadMe to share

## Resources

- [Project oriented workflows](https://www.tidyverse.org/blog/2017/12/workflow-vs-script/) by Jenny Bryan

## Lesson

### Set-up:

- In GitHub, create a new repository called `us_fisheries_landings`
- Clone the repo to create a version controlled project (remember, copy & paste the URL from the GitHub Clone / Download)
- In the local project folder, create a subfolder called 'data'
- Copy and paste the **noaa_fisheries.csv** file into the 'data' folder
- Create a new R Markdown document within your `us_fisheries_landings` project
- Knit your .Rmd to html, saving as `us_landings.Rmd`

**Data:**
NOAA Commercial Fisheries Landing data (1950 - 2017)
Accessed from: https://www.st.nmfs.noaa.gov/commercial-fisheries/commercial-landings/
Source: Fisheries Statistics Division of the NOAA Fisheries

*Note on the data:* "aggregate" here means "These names represent aggregations of more than one species. They are not inclusive, but rather represent landings where we do not have species-specific data. Selecting "Sharks", for example, will not return all sharks but only those where we do not have more specific information."

## Attach packages, read in and explore the data

Attach (load) packages with `library()`:

```{r, message = FALSE, warning = FALSE}

library(tidyverse)
library(readxl)
library(here)  
library(janitor) 
library(kableExtra)

```

Read in the noaa_fisheries.csv data as object **us_landings**:

```{r}
us_landings <- read_csv(here("data","noaa_fisheries.csv"))
```

Go exploring a bit:
```{r, eval = FALSE}
summary(us_landings)
View(us_landings)
names(us_landings)
head(us_landings)
tail(us_landings)
```

## Some data cleaning

- Clean up column names (`clean_names()`)
- Convert everything to lower case (`tolower()`)
- Remove dollar signs in value column (`parse_number()`)
- Remove the "aggregate" grouping indicator in species (`str_remove()`) %>% 
- Keep only observations that include "salmon"
- Separate the grouped name ("salmon") from any additional refined information (`separate()`)

```{r}
salmon_landings <- us_landings %>% 
  clean_names() %>% # Make column headers snake_case
  map_df(tolower) %>% # Converts character columns to lowercase, makes df (instead of list)
  mutate(dollars_usd = parse_number(dollars_usd)) %>% 
  mutate(afs_name = str_remove(afs_name, pattern = "aggregate")) %>% 
  filter(str_detect(afs_name, pattern = "salmon")) %>% # Detect matches for crab
  separate(afs_name, into = c("group","species"), sep = ",")
  

```

Explore **salmon_landings**. 

## Find grouped summary data

Find the annual total US landings and dollar value (summing across all states) for each type of salmon using `group_by()` + `summarize()`:

```{r}

salmon_summary <- salmon_landings %>% 
  mutate(landings_pounds = as.numeric(landings_pounds),
         year = as.numeric(year)) %>% 
  group_by(year, species) %>% 
  summarize(
    tot_landings = sum(landings_pounds),
    tot_value = sum(dollars_usd)
  )

```

## Make a graph of total landings by species over time

```{r}
ggplot(salmon_summary, aes(x = year, y = tot_landings, group = species)) +
  geom_line(aes(color = species)) +
  theme_bw() +
  labs(x = "year", y = "US commercial landings (pounds)")
```

TODO: Keep working on this to finish up. Another graph? Nice table? 

## Fun facts (quirky things) - making a note of these wherever possible for interest (little “Did you know?” sections)

## Interludes

## Efficiency Tips

